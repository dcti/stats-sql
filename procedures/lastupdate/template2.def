-- $Id: template2.def,v 1.5 2002/01/01 21:32:18 decibel Exp $

use ${1}
go

\set procedure=p_lastupdate_${2}

\echo "Creating procedure $procedure, referencing table ${3}, field ${4}"

create procedure $procedure (
	@project_id tinyint = 0
)
as
	/* NOTE!!!!
	** You should not be calling this procedure directly, it should
	** be called from 'lastupdate'.
	*/

	set transaction isolation level 0
	select max(${4}) as lastupdate
	from ${3}
	where PROJECT_ID = @project_id
		and ${4} > dateadd(day, -30, getdate())

	return
go

grant execute on $procedure to public
go
