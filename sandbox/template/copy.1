-- $Id: copy.1,v 1.1 2000/03/31 07:06:40 decibel Exp $

\set table=@TABLE_NAME@
\set destinationdb=@DESTINATIONDB_NAME@
\set sourcedb=@SOURCEDB_NAME@

-- Be safe; put ourselves in the tempdb
use tempdb

-- Execute the create table in the same batch as the use statement so that
-- if the use bombs the whole script *should* die.
create table #abort (abort tinyint)
go

if "$sourcedb" = "$destinationdb"
begin
	print "The source and destination destinationdbs can not be the same!"
	insert into #abort values (1)
end
go

if NOT exists (select * from #abort)
begin
	if db_id("$sourcedb") is NULL
	begin
		print "The source database '%1!' does not exist!", $sourcedb
		insert into #abort values (1)
	end
	
	if db_id("$destinationdb") is NULL
	begin
		print "The destination database '%1!' does not exist!", $destinationdb
		insert into #abort values (1)
	end
end
go

if NOT exists (select * from #abort)
begin
	if object_id("${sourcedb}..${table}") is NULL
	begin
		print "Source table '%1!' doesn't exist!", "${sourcedb}..${table}"
		insert into #abort values (1)
	end

	if object_id("${destinationdb}..${table}") is NULL
	begin
		print "Destination table '%1!' doesn't exist!", "${destinationdb}..${table}"
		insert into #abort values (1)
	end
end
go

if NOT exists (select * from #abort)
begin

